from web3 import Web3
import json



def connection_to_web3():
    url = 'HTTP://127.0.0.1:7545'
    web3 = Web3(Web3.HTTPProvider(url))
    print(web3.is_connected())
    web3.eth.default_account = web3.eth.accounts[0]
    abi = json.loads('[{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"trackId","type":"uint256"},{"indexed":false,"internalType":"string","name":"name","type":"string"},{"indexed":false,"internalType":"string","name":"artist","type":"string"},{"indexed":false,"internalType":"string","name":"song","type":"string"}],"name":"TrackUploaded","type":"event"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"musictracks","outputs":[{"internalType":"string","name":"name","type":"string"},{"internalType":"string","name":"artist","type":"string"},{"internalType":"string","name":"song","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"trackcounter","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"string","name":"_name","type":"string"},{"internalType":"string","name":"_artist","type":"string"},{"internalType":"string","name":"_song","type":"string"}],"name":"uploadTrack","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"trackId","type":"uint256"}],"name":"getMusicTrack","outputs":[{"internalType":"string","name":"","type":"string"},{"internalType":"string","name":"","type":"string"},{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getTotalTracks","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"}]')

    bytecode = '0x608060405234801561000f575f80fd5b50610c9a8061001d5f395ff3fe608060405234801561000f575f80fd5b5060043610610055575f3560e01c806304dc527d1461005957806305ed569b146100755780639490a253146100a7578063a2290b26146100c5578063bf0c4bf1146100f7575b5f80fd5b610073600480360381019061006e91906106e1565b610115565b005b61008f600480360381019061008a91906107b8565b6101e0565b60405161009e9392919061085d565b60405180910390f35b6100af610397565b6040516100bc91906108b6565b60405180910390f35b6100df60048036038101906100da91906107b8565b61039d565b6040516100ee9392919061085d565b60405180910390f35b6100ff61058b565b60405161010c91906108b6565b60405180910390f35b60015f815480929190610127906108fc565b91905055506040518060600160405280848152602001838152602001828152505f8060015481526020019081526020015f205f820151815f01908161016c9190610b3d565b5060208201518160010190816101829190610b3d565b5060408201518160020190816101989190610b3d565b509050507f543d0b3090019cdf086cddf1831f41a69b8e061ffe035d25bd07a28ce5b6cbc16001548484846040516101d39493929190610c0c565b60405180910390a1505050565b5f602052805f5260405f205f91509050805f0180546101fe90610970565b80601f016020809104026020016040519081016040528092919081815260200182805461022a90610970565b80156102755780601f1061024c57610100808354040283529160200191610275565b820191905f5260205f20905b81548152906001019060200180831161025857829003601f168201915b50505050509080600101805461028a90610970565b80601f01602080910402602001604051908101604052809291908181526020018280546102b690610970565b80156103015780601f106102d857610100808354040283529160200191610301565b820191905f5260205f20905b8154815290600101906020018083116102e457829003601f168201915b50505050509080600201805461031690610970565b80601f016020809104026020016040519081016040528092919081815260200182805461034290610970565b801561038d5780601f106103645761010080835404028352916020019161038d565b820191905f5260205f20905b81548152906001019060200180831161037057829003601f168201915b5050505050905083565b60015481565b60608060605f805f8681526020019081526020015f206040518060600160405290815f820180546103cd90610970565b80601f01602080910402602001604051908101604052809291908181526020018280546103f990610970565b80156104445780601f1061041b57610100808354040283529160200191610444565b820191905f5260205f20905b81548152906001019060200180831161042757829003601f168201915b5050505050815260200160018201805461045d90610970565b80601f016020809104026020016040519081016040528092919081815260200182805461048990610970565b80156104d45780601f106104ab576101008083540402835291602001916104d4565b820191905f5260205f20905b8154815290600101906020018083116104b757829003601f168201915b505050505081526020016002820180546104ed90610970565b80601f016020809104026020016040519081016040528092919081815260200182805461051990610970565b80156105645780601f1061053b57610100808354040283529160200191610564565b820191905f5260205f20905b81548152906001019060200180831161054757829003601f168201915b5050505050815250509050805f015181602001518260400151935093509350509193909250565b5f600154905090565b5f604051905090565b5f80fd5b5f80fd5b5f80fd5b5f80fd5b5f601f19601f8301169050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52604160045260245ffd5b6105f3826105ad565b810181811067ffffffffffffffff82111715610612576106116105bd565b5b80604052505050565b5f610624610594565b905061063082826105ea565b919050565b5f67ffffffffffffffff82111561064f5761064e6105bd565b5b610658826105ad565b9050602081019050919050565b828183375f83830152505050565b5f61068561068084610635565b61061b565b9050828152602081018484840111156106a1576106a06105a9565b5b6106ac848285610665565b509392505050565b5f82601f8301126106c8576106c76105a5565b5b81356106d8848260208601610673565b91505092915050565b5f805f606084860312156106f8576106f761059d565b5b5f84013567ffffffffffffffff811115610715576107146105a1565b5b610721868287016106b4565b935050602084013567ffffffffffffffff811115610742576107416105a1565b5b61074e868287016106b4565b925050604084013567ffffffffffffffff81111561076f5761076e6105a1565b5b61077b868287016106b4565b9150509250925092565b5f819050919050565b61079781610785565b81146107a1575f80fd5b50565b5f813590506107b28161078e565b92915050565b5f602082840312156107cd576107cc61059d565b5b5f6107da848285016107a4565b91505092915050565b5f81519050919050565b5f82825260208201905092915050565b5f5b8381101561081a5780820151818401526020810190506107ff565b5f8484015250505050565b5f61082f826107e3565b61083981856107ed565b93506108498185602086016107fd565b610852816105ad565b840191505092915050565b5f6060820190508181035f8301526108758186610825565b905081810360208301526108898185610825565b9050818103604083015261089d8184610825565b9050949350505050565b6108b081610785565b82525050565b5f6020820190506108c95f8301846108a7565b92915050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52601160045260245ffd5b5f61090682610785565b91507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8203610938576109376108cf565b5b600182019050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52602260045260245ffd5b5f600282049050600182168061098757607f821691505b60208210810361099a57610999610943565b5b50919050565b5f819050815f5260205f209050919050565b5f6020601f8301049050919050565b5f82821b905092915050565b5f600883026109fc7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff826109c1565b610a0686836109c1565b95508019841693508086168417925050509392505050565b5f819050919050565b5f610a41610a3c610a3784610785565b610a1e565b610785565b9050919050565b5f819050919050565b610a5a83610a27565b610a6e610a6682610a48565b8484546109cd565b825550505050565b5f90565b610a82610a76565b610a8d818484610a51565b505050565b5b81811015610ab057610aa55f82610a7a565b600181019050610a93565b5050565b601f821115610af557610ac6816109a0565b610acf846109b2565b81016020851015610ade578190505b610af2610aea856109b2565b830182610a92565b50505b505050565b5f82821c905092915050565b5f610b155f1984600802610afa565b1980831691505092915050565b5f610b2d8383610b06565b9150826002028217905092915050565b610b46826107e3565b67ffffffffffffffff811115610b5f57610b5e6105bd565b5b610b698254610970565b610b74828285610ab4565b5f60209050601f831160018114610ba5575f8415610b93578287015190505b610b9d8582610b22565b865550610c04565b601f198416610bb3866109a0565b5f5b82811015610bda57848901518255600182019150602085019450602081019050610bb5565b86831015610bf75784890151610bf3601f891682610b06565b8355505b6001600288020188555050505b505050505050565b5f608082019050610c1f5f8301876108a7565b8181036020830152610c318186610825565b90508181036040830152610c458185610825565b90508181036060830152610c598184610825565b90509594505050505056fea2646970667358221220d9cd5a36d2339c598bb9bdf8a538a0f275fbbb7fc9d60c41f3c575e4a63f5da964736f6c63430008140033'
    musicapp = web3.eth.contract(abi=abi, bytecode=bytecode)
    tx_hash = musicapp.constructor().transact()
    tx_reciept = web3.eth.wait_for_transaction_receipt(tx_hash)
    contract = web3.eth.contract(address=tx_reciept.contractAddress, abi=abi)
    return contract